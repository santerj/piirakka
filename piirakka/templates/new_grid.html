<!DOCTYPE html>
<html lang="en">

<head>
    <title>piirakka</title>
    {% include 'components/head.html' %}
</head>

<body class="h-screen overflow-hidden m-0">
  <div class="grid grid-cols-12 h-screen">
    <!-- Sidebar: full height -->
    <aside class="col-span-2 bg-stone-50 border border-gray-300 p-3 overflow-auto h-screen">
      {% include 'components/sidebar.html' %}
    </aside>

    <!-- Main Content: height minus player bar -->
    <main class="col-span-10 bg-white p-4 overflow-auto" style="height: calc(100vh - 4rem);">
      {% include 'components/track_history.html' %}
    </main>
  </div>

  <!-- Player Bar: fixed bottom right, does NOT cover sidebar -->
  <nav class="fixed bottom-0 left-[16.66%] w-[83.33%] h-16">
    {% include 'components/player.html' %}
  </nav>
</body>
</html>

<script>
    // open websocket
    const socket = new WebSocket('ws://localhost:8000/api/websocket');

    // Listen for connection open event
    socket.addEventListener('open', function(event) {
        console.log('WebSocket is connected.');
    });

    // Listen for messages from the server
    socket.addEventListener('message', function(event) {
        // Parse the incoming message
        const message = JSON.parse(event.data);

        // check event type
        if (message.event === 'track_changed') {
            // set track history
            const trackHistoryElement = document.getElementById('TrackHistory');
            trackHistoryElement.innerHTML = message.html;
        }

        else if (message.event === 'control_bar_updated') {
            const controlBar = document.getElementById('ControlBar');
            controlBar.innerHTML = message.html;
        }
    });

    // Listen for connection close event
    socket.addEventListener('close', function(event) {
        console.log('WebSocket is closed now.');
    });

    // Listen for errors
    socket.addEventListener('error', function(event) {
        console.error('WebSocket error:', event);
    });

  </script>
